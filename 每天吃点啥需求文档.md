# 每天吃点啥 (What to Eat Today) 需求文档

## 1. 项目目标

### 1.1 产品定位
解决用户"有食材但没灵感"、"想做饭但不知道做什么"的日常决策焦虑。

### 1.2 目标用户
- 追求生活质量的上班族
- 有一定烹饪基础的居家用户
- 时间宝贵但希望健康饮食的人群

### 1.3 核心价值
- **省心**：每日智能推荐，无需纠结
- **实用**：按餐段场景化展示，符合生活习惯
- **轻量**：无需注册，即开即用

### 1.4 MVP 目标（第一版）
- 食谱浏览
- 基础推荐
- 本地收藏

---

## 2. 技术栈

| 模块 | 技术选型 | 说明 |
|------|----------|------|
| 前端 | React Native + Expo | 跨平台，支持 OTA 热更新 |
| 后端 | Django + DRF | 成熟稳定，Admin 后台开箱即用 |
| 数据库 | PostgreSQL | 支持复杂查询，扩展性好 |
| AI | DeepSeek API | 国产大模型，用于推荐和内容生成 |
| 数据源 | HowToCook (GitHub) | 开源菜谱库，Markdown 格式 |

---

## 3. 功能需求

### 3.1 功能清单

| 模块 | 功能 | 优先级 | MVP |
|------|------|--------|-----|
| 首页 | 按早/中/晚餐场景展示推荐 | P0 | ✅ |
| 首页 | 下拉刷新换一批 | P0 | ✅ |
| 食谱详情 | 食材列表、步骤展示 | P0 | ✅ |
| 食谱详情 | 难度、耗时标签 | P0 | ✅ |
| 收藏 | 本地收藏/取消收藏 | P0 | ✅ |
| 收藏 | 收藏列表页 | P0 | ✅ |
| 搜索 | 按菜名关键词搜索 | P1 | ❌ |
| 偏好 | 本地存储口味偏好 | P1 | ❌ |
| 冰箱 | 根据现有食材反查菜谱 | P2 | ❌ |
| 购物清单 | 汇总食材生成清单 | P2 | ❌ |
| 营养 | 计算菜品营养成分 | P2 | ❌ |

### 3.2 功能详述

#### 3.2.1 首页推荐
- 分三个卡片区块：早餐、午餐、晚餐
- 每个区块展示 1-2 道推荐菜品
- 支持下拉刷新获取新推荐
- 点击卡片进入食谱详情

#### 3.2.2 食谱详情页
- 菜品封面图（如有）
- 难度星级（1-5 星）
- 预计耗时
- 食材清单（名称 + 用量）
- 烹饪步骤（分步展示）
- 收藏按钮

#### 3.2.3 收藏功能
- 本地 AsyncStorage 存储
- 收藏列表按时间倒序展示
- 支持取消收藏

---

## 4. 数据库结构设计

### 4.1 ER 关系图

```
Users (预留)
    │
    └───1:N─── UserFeedback
                  │
                  └───N:1─── Recipes
                                │
                                ├───M:N─── Ingredients
                                │            │
                                │            └───RecipeIngredient (中间表)
                                │
                                └───1:N─── RecipeInstruction (可选)
```

**关系说明：**
- `Recipes` ↔ `Ingredients`：多对多关系，通过 `RecipeIngredient` 中间表关联
- `Recipes` → `RecipeInstruction`：一对多关系（可选，如果使用独立步骤表）
- `Users` → `UserFeedback`：一对多关系（预留）
- `UserFeedback` → `Recipes`：多对一关系（预留）

### 4.2 表结构

#### Recipes（食谱表）
| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | BigAutoField | Primary Key | 主键 |
| title | CharField(100) | Not Null | 菜名 |
| difficulty | SmallInteger | Not Null, Choices(1-5) | 难度等级 1-5 星 |
| duration | Integer | Not Null, Default=30 | 预计耗时（分钟） |
| cover_url | URLField | Null, Blank | 封面图链接（可选） |
| source_url | URLField | Null, Blank | 原始来源链接（GitHub/HowToCook） |
| meal_type | CharField(20) | Not Null, Choices | 餐段类型：breakfast(早餐)/lunch(午餐)/dinner(晚餐) |
| steps | JSONField | Not Null, Default=list | 烹饪步骤数组，格式：`[{"step": 1, "description": "..."}, ...]` |
| tools | JSONField | Blank, Default=list | 所需工具列表（数组格式），如：`["锅", "铲子", "碗"]` |
| servings | PositiveSmallInteger | Null, Blank | 每份可供几人食（可选） |
| tips | TextField | Blank | 附加提示和小贴士 |
| dish_type | CharField(20) | Null, Blank, Choices | 菜品类型：aquatic(水产)/breakfast(早餐)/condiment(调味品)/dessert(甜点)/drink(饮品)/meat_dish(肉菜)/semi-finished(半成品)/soup(汤类)/staple(主食)/vegetable_dish(素菜) |
| created_at | DateTimeField | Auto Now Add | 创建时间 |
| updated_at | DateTimeField | Auto Now | 更新时间 |

**索引：**
- `meal_type`（用于推荐筛选）
- `difficulty`（用于难度筛选）
- `created_at`（用于排序）

---

#### Ingredients（食材表）
| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | BigAutoField | Primary Key | 主键 |
| name | CharField(50) | Not Null, Unique | 食材名称（唯一） |
| category | CharField(30) | Not Null, Choices | 分类：meat(肉类)/vegetable(蔬菜)/seafood(海鲜)/egg_dairy(蛋奶)/grain(谷物)/seasoning(调料)/other(其他) |
| calories | DecimalField(7,2) | Null, Blank | 每 100g 热量（kcal） |
| protein | DecimalField(6,2) | Null, Blank | 每 100g 蛋白质（g） |
| fat | DecimalField(6,2) | Null, Blank | 每 100g 脂肪（g） |
| carbs | DecimalField(6,2) | Null, Blank | 每 100g 碳水化合物（g） |
| created_at | DateTimeField | Auto Now Add | 创建时间 |
| updated_at | DateTimeField | Auto Now | 更新时间 |

**索引：**
- `category`（用于分类筛选）
- `name`（用于搜索）

**备注：** 营养成分字段（calories/protein/fat/carbs）在 MVP 阶段可为空，后续通过 DeepSeek API 自动填充。

---

#### RecipeIngredient（食谱-食材关联表）
| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | BigAutoField | Primary Key | 主键 |
| recipe_id | ForeignKey(Recipe) | Not Null, CASCADE | 关联食谱 ID |
| ingredient_id | ForeignKey(Ingredient) | Not Null, CASCADE | 关联食材 ID |
| amount | CharField(30) | Not Null, Default="适量" | 用量描述，如："200g"、"2个"、"适量"、"少许" |
| created_at | DateTimeField | Auto Now Add | 创建时间 |
| updated_at | DateTimeField | Auto Now | 更新时间 |

**索引：**
- `recipe_id`（查询食谱所需食材）
- `ingredient_id`（反向查询：根据食材找菜谱）

**唯一约束：** `(recipe_id, ingredient_id)` - 同一食谱中同一种食材只能出现一次

---

#### RecipeInstruction（制作步骤详细表 - 可选）
| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | BigAutoField | Primary Key | 主键 |
| recipe_id | ForeignKey(Recipe) | Not Null, CASCADE | 关联食谱 ID |
| step_number | PositiveSmallInteger | Not Null | 步骤序号（1, 2, 3...） |
| description | TextField | Not Null | 步骤详细描述 |
| image_url | URLField | Null, Blank | 步骤配图链接（可选） |
| created_at | DateTimeField | Auto Now Add | 创建时间 |

**索引：**
- `recipe_id`（查询食谱步骤）
- `(recipe_id, step_number)`（确保步骤顺序唯一）

**备注：** 如果使用 JSONField 存储步骤（已在 Recipes 表中），此表可选。建议统一使用 Recipes.steps JSONField，结构更简单。

---

#### Users（用户表）
| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | BigAutoField | Primary Key | 主键 |
| device_id | CharField(64) | Not Null, Unique | 设备唯一标识 |
| username | CharField(50) | Null, Blank | 用户名（可选） |
| liked_ingredients | JSONField | Default=list | 喜欢的食材 ID 列表 |
| disliked_ingredients | JSONField | Default=list | 不喜欢的食材 ID 列表 |
| favorite_recipes | JSONField | Default=list | 收藏的食谱 ID 列表 |
| disliked_recipes | JSONField | Default=list | 不喜欢的食谱 ID 列表 |
| cooked_recipes | JSONField | Default=dict | 已制作食谱及次数，格式：`{"recipe_id": count}`，如 `{"1": 3, "25": 1}` |
| preferences | JSONField | Default=dict | 其他偏好设置 |
| created_at | DateTimeField | Auto Now Add | 创建时间 |
| updated_at | DateTimeField | Auto Now | 更新时间 |

**索引：**
- `device_id`（快速查找用户）



---

#### UserFeedback（用户反馈表 - 预留）
| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | BigAutoField | Primary Key | 主键 |
| user_id | ForeignKey(User) | Not Null, CASCADE | 关联用户 ID |
| recipe_id | ForeignKey(Recipe) | Not Null, CASCADE | 关联食谱 ID |
| action_type | CharField(20) | Not Null, Choices | 操作类型：favorite(收藏)/dislike(不喜欢)/completed(已制作) |
| created_at | DateTimeField | Auto Now Add | 创建时间 |

**索引：**
- `user_id`（查询用户反馈历史）
- `recipe_id`（统计食谱受欢迎程度）
- `(user_id, recipe_id)`（防止重复反馈）

**备注：** MVP 阶段不使用，后续用于改进推荐算法。

---

## 5. 业务逻辑设计

### 5.1 推荐算法（MVP 版本）

```
输入：meal_type（餐段）
输出：推荐食谱列表

逻辑：
1. 筛选 meal_type 匹配的食谱
2. 随机抽取 N 条
3. 返回结果
```

### 5.2 推荐算法（后续迭代）

```
权重因子：
- 季节时令：当季食材菜品 +20%
- 难度匹配：工作日偏简单 +15%
- 历史反馈：收藏过的同类 +10%，不喜欢的同类 -30%
```

### 5.3 API 接口设计

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/v1/recipes/recommend/` | GET | 获取推荐，参数：meal_type |
| `/api/v1/recipes/{id}/` | GET | 食谱详情 |
| `/api/v1/recipes/` | GET | 食谱列表，支持分页 |

---

## 6. 用户体验设计

### 6.1 设计原则
- **简洁优先**：首页一屏展示三餐，无干扰信息
- **场景化**：按用餐时段组织内容
- **快速决策**：3 秒内看到推荐结果

### 6.2 页面结构

```
App
├── 首页 (HomeScreen)
│   ├── 早餐区块
│   ├── 午餐区块
│   └── 晚餐区块
├── 食谱详情 (RecipeDetailScreen)
└── 收藏列表 (FavoritesScreen)
```

### 6.3 交互规范
- 卡片点击：进入详情页
- 下拉刷新：换一批推荐
- 收藏按钮：心形图标，点击切换状态
- 底部导航：首页 / 收藏（两个 Tab）

### 6.4 视觉风格
- 色调：暖色系，突出食欲感
- 卡片：圆角阴影，菜品图片为主
- 字体：标题突出，信息层次分明

---

## 7. 项目实施步骤

### Phase 1：基础搭建（第 1 周）

| 任务 | 负责 | 产出 |
|------|------|------|
| Expo 项目初始化 | 前端 | 可运行的空白 App |
| Django 项目初始化 | 后端 | 可访问的 API 框架 |
| 数据库表结构创建 | 后端 | PostgreSQL 表 |
| Clone 菜谱 + 解析脚本 | 后端 | JSON 格式菜谱数据 |

### Phase 2：核心功能（第 2 周）

| 任务 | 负责 | 产出 |
|------|------|------|
| 推荐接口开发 | 后端 | `/recommend/` API |
| 首页 UI 实现 | 前端 | 三餐卡片布局 |
| 食谱详情页 | 前端 | 完整详情展示 |
| 前后端联调 | 全栈 | 数据正常流转 |

### Phase 3：完善体验（第 3 周）

| 任务 | 负责 | 产出 |
|------|------|------|
| 本地收藏功能 | 前端 | AsyncStorage 存储 |
| 收藏列表页 | 前端 | 收藏管理 |
| 下拉刷新 | 前端 | 换一批交互 |
| UI 打磨 | 前端 | 视觉细节优化 |

### Phase 4：测试上线（第 4 周）

| 任务 | 负责 | 产出 |
|------|------|------|
| 功能测试 | 全栈 | Bug 修复 |
| 性能优化 | 全栈 | 接口响应 <500ms |
| EAS 构建 | 前端 | iOS/Android 包 |
| 后端部署 | 后端 | Docker 上线 |

---

## 8. 项目目录结构

### 8.1 整体结构

```
whatToEatToday/
├── frontend/                # React Native + Expo 前端
├── backend/                 # Django 后端
├── scripts/                 # 数据处理脚本
├── docs/                    # 项目文档
├── .cursor/                 # Cursor 规则配置
│   └── rules/
├── 每天吃点啥需求文档.md
├── init.md
└── README.md
```

### 8.2 前端目录 (frontend/)

```
frontend/
├── app/                     # Expo Router 页面
│   ├── (tabs)/              # Tab 导航页面
│   │   ├── index.tsx        # 首页
│   │   ├── favorites.tsx    # 收藏页
│   │   └── _layout.tsx      # Tab 布局
│   ├── recipe/
│   │   └── [id].tsx         # 食谱详情页
│   └── _layout.tsx          # 根布局
├── components/              # 可复用组件
│   ├── common/
│   │   ├── Card.tsx
│   │   ├── Button.tsx
│   │   └── Loading.tsx
│   └── recipe/
│       ├── RecipeCard.tsx   # 食谱卡片
│       ├── MealSection.tsx  # 餐段区块
│       ├── StepList.tsx     # 步骤列表
│       └── IngredientList.tsx
├── hooks/                   # 自定义 Hooks
│   ├── useRecipes.ts
│   └── useFavorites.ts
├── services/                # API 调用
│   ├── api.ts               # Axios 实例
│   └── recipeService.ts
├── stores/                  # 状态管理
│   └── favoriteStore.ts     # Zustand 收藏状态
├── types/                   # TypeScript 类型
│   └── recipe.ts
├── utils/                   # 工具函数
│   └── storage.ts           # AsyncStorage 封装
├── constants/               # 常量配置
│   ├── colors.ts
│   └── config.ts
├── assets/                  # 静态资源
│   ├── images/
│   └── fonts/
├── app.json                 # Expo 配置
├── package.json
├── tsconfig.json
└── .env                     # 环境变量
```

### 8.3 后端目录 (backend/)

```
backend/
├── config/                  # 项目配置
│   ├── __init__.py
│   ├── settings/
│   │   ├── __init__.py
│   │   ├── base.py          # 基础配置
│   │   ├── development.py   # 开发环境
│   │   └── production.py    # 生产环境
│   ├── urls.py              # 根路由
│   ├── wsgi.py
│   └── asgi.py
├── apps/                    # Django Apps
│   ├── __init__.py
│   ├── recipes/             # 食谱模块
│   │   ├── __init__.py
│   │   ├── admin.py
│   │   ├── apps.py
│   │   ├── models.py        # Recipe, RecipeIngredient
│   │   ├── serializers.py
│   │   ├── views.py
│   │   ├── urls.py
│   │   ├── services.py      # 推荐算法
│   │   └── migrations/
│   ├── ingredients/         # 食材模块
│   │   ├── __init__.py
│   │   ├── admin.py
│   │   ├── models.py        # Ingredient
│   │   ├── serializers.py
│   │   ├── views.py
│   │   ├── urls.py
│   │   └── migrations/
│   └── users/               # 用户模块（预留）
│       ├── __init__.py
│       ├── models.py
│       └── migrations/
├── common/                  # 公共组件
│   ├── __init__.py
│   ├── models.py            # BaseModel 基类
│   ├── pagination.py
│   └── exceptions.py
├── prompts/                 # AI 提示词
│   └── nutrition_analysis.txt
├── manage.py
├── requirements/
│   ├── base.txt
│   ├── development.txt
│   └── production.txt
├── Dockerfile
├── docker-compose.yml
└── .env
```

### 8.4 数据目录 (data/) 与脚本目录 (scripts/)

```
data/
└── howtocook/               # git clone 的菜谱仓库
    └── dishes/              # 菜谱 Markdown 文件

scripts/
├── parse_markdown.py        # 解析 Markdown → JSON
├── import_recipes.py        # JSON → PostgreSQL
└── test_deepseek.py         # 测试 AI 接口
```

**数据获取方式：**

```bash
# 直接克隆开源菜谱仓库（无需爬虫）
git clone https://github.com/Anduin2017/HowToCook.git data/howtocook
```

### 8.5 核心文件说明

| 文件 | 说明 |
|------|------|
| `frontend/app/(tabs)/index.tsx` | 首页，三餐推荐展示 |
| `frontend/components/recipe/RecipeCard.tsx` | 食谱卡片组件 |
| `frontend/stores/favoriteStore.ts` | 收藏状态管理 |
| `backend/apps/recipes/services.py` | 推荐算法实现 |
| `backend/apps/recipes/views.py` | 食谱 API ViewSet |
| `scripts/parse_markdown.py` | Markdown 解析入口 |

---

## 附录

### A. 数据源
- HowToCook: https://github.com/Anduin2017/HowToCook.git

### B. 参考文档
- [Expo 官方文档](https://docs.expo.dev/)
- [Django REST Framework](https://www.django-rest-framework.org/)
- [DeepSeek API](https://platform.deepseek.com/)
